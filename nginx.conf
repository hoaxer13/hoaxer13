#user nobody;
worker_processes 1 ;
error_log  /var/log/nginx/error.log  warn;

pid        /var/run/nginx.pid;

events {
worker_connections 1024;
use kqueue;
}

http {
	log_format main '$remote_addr [$time_local] $host $request_method $request_uri $status $upstream_response_time';
	include mime.types;
	default_type application/octet-stream;
	client_max_body_size 128m;
	sendfile       on;
        #tcp_nopush     on;
        #tcp_nodelay    on;
        keepalive_timeout  65;
        #server_tokens off;
        gzip  on;
        gzip_min_length 1024;
        gzip_buffers 12 32k;
        gzip_comp_level 9;
        gzip_disable "MSIE [1-6]\.";
        gzip_proxied any;
        gzip_types text/plain application/xhtml+xml text/xml application/xml application/xml+rss text/css application/javascript;
        #fastcgi_intercept_errors on;
        charset utf-8;
	limit_req_zone $binary_remote_addr zone=perip:20m rate=10r/s;

server {
	listen 80;
	server_name eskalat.biz www.eskalat.biz;
	rewrite ^/(.*) https://$server_name$1 permanent;	
	}
server {
	listen       443 ssl;
        ssl on;
        server_name     eskalat.biz www.eskalat.biz;
        ssl_certificate /var/www/eskalat/cert/eskalat.biz.crt;
        ssl_certificate_key     /var/www/eskalat/cert/crm.nopass.key;
        ssl_protocols   TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers     HIGH:!aNULL:!MD5;
        access_log  /var/log/nginx/eskalat.access.log  main;
        root /var/www/eskalat/www/;
    #    limit_req zone=perip burst=20 nodelay;   
    #    limit_req_log_level info ;
    #    limit_req_status 503;

location / {
	root /var/www/eskalat/www/;
	index index.php index.html index.htm;
}


error_page 500 502 503 504 /50x.html;

location = /50x.html {
	root /usr/local/www/nginx-dist;
}

location ~ \.php$ {
	root /var/www/eskalat/www;
	fastcgi_pass unix:/tmp/php-fpm.sock;
	fastcgi_index index.php;
	fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
	include fastcgi_params;
	fastcgi_read_timeout 600;
}

# phpMyAdmin 
location ~ ^/pma/(.*\.php)$ { 
	#fastcgi_pass unix:/tmp/php-fpm.sock; 
#	fastcgi_pass 127.0.0.1:9000;
	fastcgi_pass unix:/tmp/php-fpm.sock;
	include fastcgi_params; 
	fastcgi_param SCRIPT_FILENAME /usr/local/www/phpMyAdmin/$1; 
	fastcgi_param DOCUMENT_ROOT /usr/local/www/phpMyAdmin; 
}

# php-fpm status 
location = /status.html { 
#	fastcgi_pass unix:/tmp/php-fpm.sock;
#	include fastcgi_params; 
#	fastcgi_param SCRIPT_FILENAME /usr/local/share/php/fpm/; 
#	fastcgi_param DOCUMENT_ROOT /usr/local/share/php/fpm/; 
	root /usr/local/share/php/fpm;
} 
}

###domoved
server {
	listen domoved.eskalat.biz:80;
	server_name domoved.eskalat.biz www.domoved.eskalat.biz;
	rewrite ^/(.*) https://$server_name$1 permanent;	
	}
server {
	listen       443 ssl;
        ssl on;
        server_name     domoved.eskalat.biz www.domoved.eskalat.biz;
        ssl_certificate /var/www/domoved.eskalat.biz/cert/domoved.eskalat.biz.crt;
        ssl_certificate_key     /var/www/domoved.eskalat.biz/cert/domoved.nopass.key;
        ssl_protocols   TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers     HIGH:!aNULL:!MD5;
        access_log  /var/log/nginx/eskalat.access.log  main;
        root /var/www/domoved.eskalat.biz/www/;
    #    limit_req zone=perip burst=20 nodelay;   
    #    limit_req_log_level info ;
    #    limit_req_status 503;

location / {
	root /var/www/domoved.eskalat.biz/www/;
	index index.php index.html index.htm;
}
location ~ \.php$ {
	root /var/www/eskalat/www;
	fastcgi_pass unix:/tmp/php-fpm.sock;
	fastcgi_index index.php;
	fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
	include fastcgi_params;
	fastcgi_read_timeout 600;
}
}



#cod

#server {
#        listen XN--D1ATX7A.XN--P1AI:80;
#	server_name XN--D1ATX7A.XN--P1AI ;
#	rewrite ^(.*) https://$server_name$1 permanent;
#}
#server {
#	listen       443 ssl;
#        ssl on;
#        server_name    XN--D1ATX7A.XN--P1AI;
#        ssl_certificate /var/www/wleskalat/cert/codrf.crt;
#        ssl_certificate_key     /var/www/wleskalat/cert/codrfnopass.key;
#        ssl_protocols   TLSv1 TLSv1.1 TLSv1.2;
#        ssl_ciphers     HIGH:!aNULL:!MD5;
#        access_log  /var/log/nginx/eskalat.access.log  main;
#        root /var/www/wleskalat/www/;
    #    limit_req zone=perip burst=20 nodelay;   
    #    limit_req_log_level info ;
    #    limit_req_status 503;


#location / {
#        root /var/www/wleskalat/www/;
#        index  index.html index.htm index.php ;
#        }
#         error_page   500 502 503 504  /50x.html;
#         location = /50x.html {
#            root   /usr/local/www/nginx-dist;
#        }
#
#location ~ \.php$ {
#        root /var/www/wleskalat/www;
#        #root           html;
#        fastcgi_pass   unix:/tmp/php-fpm.sock;
#        fastcgi_index  index.php;
#        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
#        include fastcgi_params;
#        fastcgi_read_timeout 600;
#        }
#}
###cod
}
